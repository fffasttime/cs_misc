## 2 空间数据索引：kd树或R树

### kd树算法描述

kd树用于对k维空间的数据点进行与距离有关的查找。

构建一棵kd树的算法：

1）开始：构造根节点，根节点对应于包含T的k维空间的超矩形区域。选择x。为坐标轴，以T中所有实例的x1坐标的中位数为切分点，将根节点对应的超矩形区域切分为两个子区域。切分由通过切分点并与坐标轴x1垂直的超平面实现。由根节点生成深度为1的左右子树：左子树对应于坐标x1的值小于切分点的子区域，右子树对应于坐标x1的值大于切分点的子区域。将落在切分超平面上的实例点保存在根节点。

2）重复：对于深度为l的节点，选择xj为切分的坐标轴，j=l(modk)+1，举例来讲就是第一次切分选择坐标x1，第二次选择坐标x2，第三次选择坐标x3，当k维后，返回到x1继续作为切分坐标。切分由通过切分点并与轴xj垂直的超平面实现。对于左右子树，以xj坐标的中位数为切分点，并保存为子树的根节点，然后同样分成两个子树。

3）直到两个子区域没有实例存在时停止，从而形成kd树的区域划分。

在kd树的搜索：

1）首先在kd树中找出包含目标点x的叶节点。方法是从根节点出发，递归地向下访问kd树，若目标点x当前维的坐标小于切分点的坐标，则往左子树查找，否则往右子树查找，一直到叶节点为止。

2）以此叶节点为“当前最邻近点”

3）递归往上回退，在每个节点上进行如下操作如果该节点的实例比当前保存的最近点的距离更近，则以该节点为“当前最邻近点”检查另一边子树有没有更近的点，如果有则从该节点往下找即检查当前节点的超平面是否跟以目标节点x为圆心，目标节点x与“当前最邻近点”的距离为半径构成的圆体相交。如果相交，可能在超平面的另外一侧有节点离目标节点更近，因此移动到超平面的另外一侧的递归执行搜索如果不相交，则向上回退

4）当回退到根节点时（根节点已经完成了步骤3 的操作），搜索结束，最后的“当前最近点”即为x的最邻近点。

### 测试

对CA.txt的22227个数据点构建存储结构，并对22227个点分别查找最近邻。

建立树结构和执行所有查询耗费的时间均不超过0.1秒。

如果与暴力查询进行对比，

暴力查询耗费的时间为10081ms，约为使用kd树的120倍。